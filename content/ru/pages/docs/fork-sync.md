---
date: 2025-01-08
title: "Синхронизация форка ergohaven-zmk-config в GitHub"
tags: ["guide", "zmk"]
---

Прошивки клавиатур постоянно дорабатываются и обновляются, и если доработки имеют общий характер и вносились в главный репозиторий **ZMK**, то эти обновления автоматически подтянутся при следующей сборке прошивки, например после изменения раскладки, но также периодически обновляется и репозиторий **ergohaven-zmk-config**, содержащий в себе раскладки и конфигурационные файлы клавиатур. Обновления могут содержать в себе, например, файлы, необходимые для сборки прошивок под новые девайсы, или же какие-то доработки в уже выпущенных устройствах, и в отличие от обновлений в **ZMK**, обновления в **ergohaven-zmk-config** автоматически не применяются, чтобы внести их в Ваш форк, необходимо провести процедуру синхронизации. О том, как провести процедуру синхронизации и будет рассказано в этом руководстве.  

> Приложение GitHub является сторонним софтом, каких-то деталей его функционала автор может не знать, а также какой-то функционал с течением времени может измениться. При возникновении каких-либо вопросов или проблем пишите в [сообщество Ergohaven в Telegram](https://t.me/+E-mlq11c97AyZmY6).

## Синхронизация форка

О необходимости синхронизировать форк вы можете узнать по появлению ссылки с текстом *"commits behind"* на вкладке **Code** форка, в обычных условиях при этом также должна появиться кнопка **Sync fork**, если ее нет, то перейдите к разделу [Кнопка Sync Fork не отобразилась](#кнопка-sync-fork-не-отобразилась). 

![image](/images/fork-sync/sync-fork.png)

Для синхронизации нажмите кнопку **Sync fork**. 

![image](/images/fork-sync/update-branch.png)

В появившемся окне нажмите кнопку **Update branch** и все, форк успешно синхронизирован, все изменения из основного репозитория уже в вашем форке.

Если после нажатия **Sync fork** отобразилось окно с заголовком *"This branch has conflicts that must be resolved"*, то есть 2 варианта синхронизации:
1) Отбросить все внесенные Вами в форк изменения, **ВНИМАНИЕ** при этом раскладка в Вашем форке вернется к стандартной, так что делайте это, только если уверены, что можете без проблем восстановить все свои изменения. Для отбрасывания изменений с синхронизацией форка нажмите **Discard commits**.
2) Решить конфликты слияния. Решение конфликтов описано в разделе [Синхронизация с конфликтами слияния](#синхронизация-с-конфликтами-слияния).
 

![image](/images/fork-sync/has-conflicts.png)

## Кнопка Sync Fork не отобразилась

Чтобы начать процедуру синхронизации нажмите на ссылку с текстом *"commits behind"* на вкладке **Code** форка.

![image](/images/fork-sync/commits-behind.png)

Откроется страница "Comparing changes", обратите внимание на выбранные по умолчанию значения:
- *base repository* - по умолчанию должно быть выбрано *"{Ваш ник на GitHub}/ergohaven-zmk-config"*;
- *base* - по умолчанию должно быть выбрано *"main"*;
- *head repository* - по умолчанию должно быть выбрано *"ergohaven/ergohaven-zmk-config"*;
- *compare* - по умолчанию должно быть выбрано *"main"*;  

![image](/images/fork-sync/comparing-changes.png)

Если какие-то из значений отличаются, выберите значение, которое должно быть по-умолчанию.  
Далее нажмите кнопку **Create pull request**.  

![image](/images/fork-sync/create-pull-request.png)

Введите название пулл-реквеста, если оно не было заполнено автоматически, и нажмите кнопку **Create pull request**.  

![image](/images/fork-sync/pr-name.png)

Если в нижней части пулл-реквеста отобразилось сообщение *"No conflicts with base branch"*, то нажмите кнопку **Merge pull request** и ветка успешно обновлена! Можете перейти на вкладку **Actions**, сборка обновленной прошивки уже запущена.

![image](/images/fork-sync/no-conflicts.png)

Если в нижней части пулл-реквеста отобразилось сообщение *"This branch has conflicts that must be resolved"*, то закройте созданный пулл-реквест нажатием **Close pull request** в нижней части страницы и перейдите к разделу [Синхронизация с конфликтами слияния](#синхронизация-с-конфликтами-слияния).

![image](/images/fork-sync/merge-conflicts.png)


## Синхронизация с конфликтами слияния

Если в основном репозитории были внесены изменения в файлы, которые Вы также изменяли в своем форке, например файлы `.keymap`, в которых хранятся раскладки клавиатур, то при обновлении форка могут возникнуть конфликты слияния, далее описаны шаги для их решения.

1) На вкладке **Code** нажмите кнопку **Branches**.

![image](/images/fork-sync/branches.png)

2) Нажмите **New branch**.

![image](/images/fork-sync/new-branch.png)

3) В появившемся окне введите название ветки, например *"sync"*, затем в выпадающем списке выберите репозиторий *"ergohaven/ergohaven-zmk-config"*, по умолчанию должна быть выбрана ветка *"main"*, и нажмите **Create new branch**.

![image](/images/fork-sync/create-new-branch.png)

4) Далее в строке созданной ветки нажмите **•••** и в открывшемся выпадающем списке выберите **New pull request**.

![image](/images/fork-sync/new-pull-request.png)

5) Нажмите на *base repository* и выберите в выпадающем списке форк *"{Ваш ник на GitHub}/ergohaven-zmk-config"*.

![image](/images/fork-sync/new-pull-request.png)

6) На открывшейся странице "Comparing changes" нажмите кнопку **Create pull request**.

![image](/images/fork-sync/create-pull-request-again.png)

7) В зависимости от количества синхронизируемых коммитов кнопка **Resolve conflicts** может быть не видна сразу, пролистайте до нее и нажмите.

![image](/images/fork-sync/resolve-conflicts.png)

8) Откроется инструмент для разрешения конфликтов, в левой части страницы отображена панель с списком файлов, конфликты в которых надо разрешить, а в правой части содержимое файлов с отмеченными местами конфликтов.

![image](/images/fork-sync/resolve-conflicts.png)

9) Между `<<<<<<< sync` (*"sync"* в данном примере это название созданной ветки) и `=======` находятся изменения из основного репозитория *"ergohaven/ergohaven-zmk-config"*, вызвавшие конфликт. Между `=======` и `>>>>>>> main` находятся изменения, внесенные Вами в раскладку.  
Далее необходимо внимательно рассмотреть каждый конфликт и решить, хотите ли вы внести в свою раскладку изменения, предложенные из *"ergohaven/ergohaven-zmk-config"*.  

- Если Вы понимаете, что изменение из основного репозитория Вам **не нужно**, то удалите строки, начиная с `<<<<<<< sync` и заканчивая `=======`, затем пролистайте файл до строки `>>>>>>> main`, означающей окончание данного конфликта, и также сотрите эту строку. Конфликт разрешен.  

{{< video 
    autoplay="true"
    loop="true"
    muted="true"
    src="/video/fork-sync/remove-incoming.mp4" 
>}}
<br />

- Если Вы понимаете, что изменение из основного репозитория Вам **нужно**, то удалите строку `<<<<<<< sync`, строку `=======` и строку `>>>>>>> main`, тем самым добавляя изменение из основного репозитория к раскладке. Конфликт разрешен.  

{{< video 
    autoplay="true"
    loop="true"
    muted="true"
    src="/video/fork-sync/accept-incoming.mp4" 
>}}
<br />

- Если Вы **не понимаете**, или **не уверены**, что делает какое-то изменение из основного репозитория, то обратитесь за помощью с разрешением конфликта в [Сообщество Ergohaven в Telegram](https://t.me/+E-mlq11c97AyZmY6).  

10) После разрешения всех конфликтов в файле станет доступна кнопка **Mark as resolved**, нажмите ее чтобы завершить разрешение конфликтов в файле.  
11) После разрешения конфликтов во всех файлах отобразится кнопка **Commit merge**, нажмите ее для завершения.

![image](/images/fork-sync/commit-merge.png)

12) Пролистайте страницу до кнопки **Merge pull request**, нажмите ее, и затем нажмите **Confirm merge**.  

13) Последним шагом для того, чтобы удостовериться, что все конфликты разрешены перейдите на вкладку **Actions**, дождитесь завершения сборки прошивки. Если конфликты разрешены корректно, то сборка прошивки успешно завершится.

