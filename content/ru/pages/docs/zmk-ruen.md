+++
title = "RuEn раскладка для беспроводных клавиатур"
tags = ["guide", "zmk"]
+++

Если вы хотя бы раз задавались вопросом, почему на русском и английском языках такие частые символы как точка и запятая расположены на разных клавишах, или почему на русском нельзя напечатать фигурную скобку, подход **RuEn** позволяет решить это недоразумение, унифицируя положение символов на русской и английской раскладке.

> Расположить символы можно одинаково и на любом другом языке, русским и английским языками подход не ограничен.

## Концепция

В целом печать какого либо символа работает так: клавиатура отправляет информацию, что была нажата клавиша в определенной позиции, а ОС принимает это нажатие, и в зависимости от того, какая сейчас раскладка в ОС, напечатает нужный символ. Рассмотрим на примерах.
**На клавиатуре нажата клавиша "KC_Q"**
- если в ОС выбрана стандартная английская раскладка, то напечатается буква "Q";
- если в ОС выбрана стандартная русская раскладка, то напечатается буква "Й".

> Наличие разных букв в разных раскладках по большей части привычное дело, хотя существуют и фонетические раскладки, при которых, например букву "О" располагают в русском и английском на одном месте, это позволяет снизить когнитивую нагрузку на запоминание разных раскладок, но слова в русском и английском строятся по-разному, и в удобстве печати фонетическая раскладка будет уступать.

**На клавиатуре нажата клавиша "SLASH"**
- если в ОС выбрана стандартная английская раскладка, то напечатается слэш "/";
- если в ОС выбрана стандартная русская раскладка, то напечатается точка ".".

**На клавиатуре нажата клавиша "DOT"**
- если в ОС выбрана стандартная английская раскладка, то напечатается точка ".";
- если в ОС выбрана стандартная русская раскладка, то напечатается буква "Ю".

**На клавиатуре нажата клавиша "LEFT_BRACE"**
- если в ОС выбрана стандартная английская раскладка, то напечатается символ "{";
- если в ОС выбрана стандартная русская раскладка, то напечатается буква "Х".

Проблематика обозначена - в стандартных раскладках ОС точка, и многие другие символы, печатаются совсем разными клавишами, а некоторых символов, как например "{" в русской раскладке нет вовсе, рассмотрим возможные решения задачи унификации расположения символов. Решить можно двумя способами:
1) на стороне ОС, установив на компьютер раскладку, в которой символы находятся на одной клавише, например https://github.com/braindefender/universal-layout, но тут стоит учитывать, что устанавливать раскладку надо на каждый компьютер, также как и на удаленные рабочие столы к которым подключаетесь;
2) на стороне клавиатуры, настроив раскладку с использованием подхода **RuEn**, тут также есть минус в том, что эти настройки находятся именно в клавиатуре и на встроенной клавиатуре ноутбука символы на разных языках будут находиться на разных клавишах.

Далее в статье рассказано о способе решения задачи на стороне клавиатуры с использованием подхода **RuEn**.

## С чего начать

Для клавиатур *Ergohaven* подготовлены раскладки, содержащие в себе все нужные для настройки макросы, эти раскладки имеют постфикс `_ruen` в названии.

![image](/images/zmk-ruen/layout-name.png)

Можно взять `ruen` раскладку за основу, или если у вас уже есть много наработок в своей раскладке, просто создать в ней такие же макросы и создать отдельные слои для каждого языка.

> При переносе макросов в свою раскладку обратите внимание также на параметры макросов, отображаемые при нажатии на кнопку с иконкой гаечного ключа, важно не забыть перенести настройки `Wait (ms)` и `Tap (ms)`.

Макросы в раскладке `ruen` ориентированы на использование сочетаний для безусловного переключения языка, `Ctrl + Shift + 1` для включения английского языка, и `Ctrl + Shift + 2` для включения русского языка (аналог режима RuEn M1M2 из Vial). Такой подход требует дополнительной настройки на стороне ОС, но при этом сильно упрощает синхронизацию языка в клавиатуре с языком в ОС. Если же такой подход переключения языка Вам по какой-то причине не подходит, подход `ruen` неплохо уживается и с стандартным сочетанием клавиш `GUI + Space`, подробнее описано в разделе [RuEn по модели тоггл](#ruen-по-модели-тоггл) (аналог режимов RuEn M0 и RuEn Dflt из Vial).

### Как работает RuEn

Поделим символы на 2 группы и разберем отдельно каждую.

#### Символы, которые встречаются в обоих языках

Первая группа - символы, которые встречаются в обоих языках, но расположены на разных клавишах, как например точка или знак вопроса. 
Для объединения расположения таких символов нам нужно каким-то образом дать клавиатуре понять, какой сейчас язык в ОС, чтобы клавиатура нажала соответствующую языку клавишу. Например, если мы хотим унифицировать положение **точки**, то на русском языке клавиатуре надо отправить в ОС нажатие клавиши `SLASH`, а на английском `DOT`. 

Для решения этой задачи отлично подходит функционал слоев, мы можем настроить так, чтобы одновременно с переключенем языка в ОС, переключался и слой в клавиатуре, и тогда он будет выполнять функцию переменной, в зависимости от этой переменной и отправится код нужной клавиши. 
В качестве описанной ранее переменной, в раскладке `ruen` имеются 2 отдельных слоя `En` и `Ru`. Чтобы расположить **точку** на одну и ту же клавишу делаем следующие действия:
- На слое `en` назначаем на нужную клавишу поведение `&kp DOT`

![image](/images/zmk-ruen/en-dot.png)

- На слое `ru` на эту же позицию назначаем поведение `&kp SLASH` 

![image](/images/zmk-ruen/ru-dot.png)

- Для переключения языка надо использовать только макросы `&layer_en` и `&layer_ru`. Макрос `&layer_ru` отправит в ОС сочетание клавиш `Ctrl + Shift + 2`, таким образом ОС переключится на русский язык и одновременно с этим клавиатура переключится на слой `ru`, таким образом ОС и клавиатура будут синхронно находиться на русской раскладке, аналогично макрос `&layer_en` отправит в ОС сочетание `Ctrl + Shift + 1` для включения английской раскладки, и переключит клавиатуру на слой `en`.

![image](/images/zmk-ruen/layer-macro.png)

В раскладке `ruen` по умолчанию эти макросы назначены на клавиши на 4 слое. 

![image](/images/zmk-ruen/layer-4.png)

Цель достигнута, теперь **точка** печатается на обоих языках нажатием одной и той же клавиши.

![image](/images/zmk-ruen/ruen-dot.png)


#### Символы, которые встречаются только в одном из языков

Вторая группа - символы, которые встречаются только в одном из языков, либо только на английском, как символ "&", либо только на русском, например "№".
Чтобы напечатать символ из этой группы, находясь на русской раскладке, надо сделать следующие действия:

1) Переключить язык в ОС на английский нажатием `Ctrl + Shift + 1`;

2) Нажать сочетание клавиш для печати символа, в случае с символом `&`, это сочетание клавиш `Shift + 7`;

3) Переключить язык в ОС обратно на русский нажатием `Ctrl + Shift + 2`.

Все эти действия содержит в себе параметризованный макрос `&en` из `ruen` раскладки. Просто назначаем макрос на клавишу на слое `ru`, и в качестве параметра указываем кейкод `AMPS`, либо сочетание клавиш `Shift + 7`.

![image](/images/zmk-ruen/en-macro.png)

Но что делать, если сейчас включен английский язык, ведь если мы используем этот макрос на нем, то напечатается символ "&" и последним шагом язык переключится на русский? С решением этой проблемы нас снова выручает функционал слоев в клавиатуре. Находясь на английском языке для того чтобы напечатать этот символ нет необходимости в переключении на другой язык, и мы просто можем назначить стандартное поведение `&kp AMPS` на нужную клавишу.


#### Символьный слой

На базовых слоях `ru` и `en` кнопок под все нужные символы конечно же не хватит, да и в целом символы может быть удобнее расположить на отдельном **символьном** слое, чтобы применить подход `ruen` для создания отдельного символьного слоя потребуется создать 2 отдельных слоя, один для печати символов, находясь на русском языке, и второй, для печати символов, находясь на английском языке. В раскладке `ruen` по умолчанию это слои `sym_en` и `sym_ru`.

![image](/images/zmk-ruen/sym-layers.png)

Чтобы соблюсти синхронизацию языков в ОС и клавиатуре 

### Алиасы

RU_COMMA  и другие русские символы нужны чисто косметически, чтобы раскладку русскую понятно отображать. Русская Й это считай алиас для клавиши Q, просто легенда нанесена понятнее будет.

> В прошивках от `Ergohaven` добавлены специальные кейкоды-алиасы для русских клавиш, под

![image](/images/zmk-ruen/ru-dot.png)

Также чтобы на ру слое на кнопке кавычек отображались именно кавычки, а не "шифт + 2" в ruen раскладке есть алиас коды, имеющие по капотом "шифт + 2", но отображающие именно кавычку
Благодаря этому слой выглядит читаемее


### RuEn по модели тоггл

Описание мод морфа спейс + гуи, необходимость отдельной кнопки &tog 1

### Комбо



### Капс ворд






