+++
title = "RuEn раскладка для беспроводных клавиатур"
tags = ["guide", "zmk"]
+++

Если вы хотя бы раз задавались вопросом, почему на русском и английском языках такие частые символы как точка и запятая расположены на разных клавишах, или почему на русском нельзя напечатать фигурную скобку, подход **RuEn** позволяет решить это недоразумение, унифицируя положение символов на русской и английской раскладке.

> Расположить символы можно одинаково и на любом другом языке, русским и английским языками подход не ограничен.

## Концепция

В целом печать какого либо символа работает так: клавиатура отправляет информацию, что была нажата клавиша в определенной позиции, а ОС принимает это нажатие, и в зависимости от того, какая сейчас раскладка в ОС, напечатает нужный символ. Рассмотрим на примерах.
**На клавиатуре нажата клавиша "KC_Q"**
- если в ОС выбрана стандартная английская раскладка, то напечатается буква "Q";
- если в ОС выбрана стандартная русская раскладка, то напечатается буква "Й".

> Наличие разных букв в разных раскладках по большей части привычное дело, хотя существуют и фонетические раскладки, при которых, например букву "О" располагают в русском и английском на одном месте, это позволяет снизить когнитивую нагрузку на запоминание разных раскладок, но слова в русском и английском строятся по-разному, и в удобстве печати фонетическая раскладка будет уступать.

**На клавиатуре нажата клавиша "SLASH"**
- если в ОС выбрана стандартная английская раскладка, то напечатается слэш "/";
- если в ОС выбрана стандартная русская раскладка, то напечатается точка ".".

**На клавиатуре нажата клавиша "DOT"**
- если в ОС выбрана стандартная английская раскладка, то напечатается точка ".";
- если в ОС выбрана стандартная русская раскладка, то напечатается буква "Ю".

**На клавиатуре нажата клавиша "LEFT_BRACE"**
- если в ОС выбрана стандартная английская раскладка, то напечатается символ "{";
- если в ОС выбрана стандартная русская раскладка, то напечатается буква "Х".

Проблематика обозначена - в стандартных раскладках ОС точка, и многие другие символы, печатаются совсем разными клавишами, а некоторых символов, как например "{" в русской раскладке нет вовсе, рассмотрим возможные решения задачи унификации расположения символов. Решить можно двумя способами:
1) на стороне ОС, установив на компьютер раскладку, в которой символы находятся на одной клавише, например https://github.com/braindefender/universal-layout, но тут стоит учитывать, что устанавливать раскладку надо на каждый компьютер, также как и на удаленные рабочие столы к которым подключаетесь;
2) на стороне клавиатуры, настроив раскладку с использованием подхода **RuEn**, тут также есть минус в том, что эти настройки находятся именно в клавиатуре и на встроенной клавиатуре ноутбука символы на разных языках будут находиться на разных клавишах.

Далее в статье рассказано о способе решения задачи на стороне клавиатуры с использованием подхода **RuEn**.

## С чего начать

Для клавиатур *Ergohaven* подготовлены раскладки, содержащие в себе все нужные для настройки макросы, эти раскладки имеют постфикс `_ruen` в названии.

![image](/images/zmk-ruen/layout-name.png)

Можно взять `ruen` раскладку за основу, или если у вас уже есть много наработок в своей раскладке, просто создать в ней такие же макросы и создать отдельные слои для каждого языка.

> При переносе макросов в свою раскладку обратите внимание также на параметры макросов, отображаемые при нажатии на кнопку с иконкой гаечного ключа, важно не забыть перенести настройки `Wait (ms)` и `Tap (ms)`.

### Как работает RuEn

Поделим символы на 2 группы и разберем отдельно каждую.

1) Символы, которые встречаются в обоих языках, но расположены на разных клавишах, как например точка или знак вопроса. 
Для объединения расположения таких символов нам нужно каким-то образом дать клавиатуре понять, какой сейчас язык на компьютере, чтобы клавиатура нажала соответствующую языку клавишу. Если мы хотим унифицировать положение точки, то на русском языке клавиатуре надо отправить в ОС нажатие клавиши `SLASH`, а на английском `DOT`. 

Чтобы клавиатура понимала, какой сейчас включен язык, отлично подходит функционал слоев, мы можем настроить так, чтобы одновременно с переключенем языка в ОС переключался и слой, и тогда он будет выполнять функцию переменной, в зависимости от этой переменной и отправится код нужной клавиши. 
Рассмотрим на примере. В качестве описанной выше переменной, в раскладке `ruen` имеются 2 отдельных слоя `En` и `Ru`, для работы подхода **RuEn** нам надо сделать так, чтобы когда в ОС включен русский язык, в клавиатуре был активен слой `Ru`, чтобы

2) Символы, которые есть только на одном языке, либо только на английском, как упомянутый ранее символ "{", либо только на русском, например "№".

. Чтобы на

-
Надо настроить чтобы ОС также распознавало переключение языка
Макрос &en работает так:
1) Отправляет сочетание для переключения на английский в ОС
2) Жмет клавишу, например квадратной скобки
3) Переключает язык обратно на русский

Макрос у тебя на комбе, это норм
Тебе надо в ОС настроить, чтобы при нажатии сочетания Ctrl + Shift + 1 включалась английская раскладка, а при нажатии Ctrl + Shift + 2 включалась русская раскладка


~~объяснение общей концепции (клава отправляет скан коды, ОС их парсит)~~
- подготовить изменения в раскладке с кейкодами как в QMK (sync, подумать над названиями ru_layer, сейчас сходу не понятно что они делают)
~~- посмотреть что еще писал Андрею про эту статью~~
- в каких случаях и зачем надо дублировать слои
- комбо с руеном
- капс ворд для русского



- тут посмотреть переработать
Плюс с помощью змкашных key overrides кстати можно реализовать часть функционала RuEn. Можно сделать так, чтобы при нажатии Ctrl + Space (любое дефолтное сочетание тоггла раскладки в ОС), одновременно и переключился слой, от этого опять же будет костыльный RuEn работать. (в оригинальном qmk-шном руене такого поведения достичь кстати вообще нельзя, чтобы ты жмакнул именно Ctrl + Space и все работало, обязательно использовать юзеркоды РуЕн

- gui + space 
Я думал о варианте, как реализовать дефолтный тоггл, по идее и в винде и в макос gui + space язык переключают, можно с этим сочетанием сделать макрос, в него дополнительно запихнуть тоггл языка (по идее это даже на дефолтных слоях можно реализовать, кстати, тоггля Ru слой при нажатии макроса), и нужен будет отдельный макрос RuEn Sync, тогглящий Ru слой, если вдруг сбилось, как было в qmk ruen.

Но тут уже видимо придется думать о том, как переключать режимы с m1m2 на gui+space


-
Чтобы работал RuEn надо переключать язык макросами layer_ru и layer_en, в ОС должно быть настроено включение русского нажатием Ctrl + Shift + 2, включение английского нажатием Ctrl + Shift + 1. Для русского и английского есть 2 отдельных слоя, соответственно на русский символьный переключение происходит с русского. На русском символьном для символов, которых нет на русской раскладке, используется макрос &en, при назначении макроса в раскладке указываем символ, который надо ввести.

- 
RU_COMMA  и другие русские символы нужны чисто косметически, чтобы раскладку русскую понятно отображать. Русская Й это считай алиас для клавиши Q, просто легенда нанесена понятнее будет.

С русского слоя по клавише символьного слоя будет происходить переход на русский символьный слой, на английском соответственно будет переход на английский символьный
На русском символьном чтобы печатался ? назначаешь "шифт + 7", а на английском символьном "шифт + слэш" 

В раскладке эргохевен ruen можно использовать макрос &en на русском слое, который переключит на инглиш в ОС, нажмёт нужную клавишу и вернет обратно русский в ОС

Также чтобы на ру слое на кнопке кавычек отображались именно кавычки, а не "шифт + 2" в ruen раскладке есть алиас коды, имеющие по капотом "шифт + 2", но отображающие именно кавычку
Благодаря этому слой выглядит читаемее